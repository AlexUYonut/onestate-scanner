Name: OneState Auto Scanner
on: 
  workflow_dispatch:
    inputs:
      ipa_url:
        description: 'Lipește link-ul IPA'
        required: true

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - name: Descărcare IPA
        run: wget -O game.ipa "${{ github.event.inputs.ipa_url }}"
          
      - name: Extragere Fișiere Joc
        run: |
          unzip game.ipa -d temp_ipa
          find temp_ipa -name "global-metadata.dat" -exec cp {} ./metadata.dat \;
          find temp_ipa -name "UnityFramework" -exec cp {} ./binary \; || find temp_ipa -name "OneState" -exec cp {} ./binary \;

      - name: Scanare Avansată Offsets
        run: |
          echo "=== ANALIZĂ ONESTATE POSIBILE OFFSETS ===" > rezultate_scanare.txt
          
          echo -e "\n[1] AIMBOT & ROTATION:" >> rezultate_scanare.txt
          strings -t x ./binary | grep -Ei "GetLocalSpaceAim|set_rotation|get_rotation|lookAt|aimbot|headshot" | head -n 30 >> rezultate_scanare.txt
          
          echo -e "\n[2] PLAYER MOVEMENT (Speed & Jump):" >> rezultate_scanare.txt
          strings -t x ./binary | grep -Ei "get_speed|set_speed|WalkSpeed|RunSpeed|MovementSpeed|JumpHeight|JumpPower|get_isGrounded|GravityMultiplier" | head -n 40 >> rezultate_scanare.txt
          
          echo -e "\n[3] FREEZE & STUCK (Troll jucători):" >> rezultate_scanare.txt
          strings -t x ./binary | grep -Ei "set_isFrozen|Freeze|set_active|set_enabled|set_isStatic|StopMovement|Anchor" | head -n 30 >> rezultate_scanare.txt
          
          echo -e "\n[4] HEALTH & GODMODE:" >> rezultate_scanare.txt
          strings -t x ./binary | grep -Ei "Health|get_isDead|set_health|Damage|Invincible" | head -n 30 >> rezultate_scanare.txt
          
          echo -e "\n[5] VEHICLE TROLL (Mass, Speed, Gravity):" >> rezultate_scanare.txt
          strings -t x ./binary | grep -Ei "VehicleSpeed|EngineRotation|Nitro|set_mass|AddForce|Rigidbody|Gravity|Force|BrakeForce|Acceleration" | head -n 50 >> rezultate_scanare.txt

          echo -e "\n[6] WORLD & PHYSICS TROLL:" >> rezultate_scanare.txt
          strings -t x ./binary | grep -Ei "get_gravity|set_gravity|Collision|Explosion|Push|Knockback" | head -n 30 >> rezultate_scanare.txt

      - name: Salvare Rezultate
        uses: actions/upload-artifact@v4
        with:
          name: OneState-Final-Offsets
          path: |
            rezultate_scanare.txt
            metadata.dat
